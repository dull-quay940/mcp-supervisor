#!/bin/bash

# MCP Supervisor Setup Script
# This script sets up the MCP Supervisor on Ubuntu 24.04

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘           MCP Supervisor Setup Script                         â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js is not installed"
    echo "Installing Node.js 20..."
    curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
    sudo apt-get install -y nodejs
else
    echo "âœ… Node.js is installed: $(node --version)"
fi

# Check if npm is installed
if ! command -v npm &> /dev/null; then
    echo "âŒ npm is not installed"
    exit 1
else
    echo "âœ… npm is installed: $(npm --version)"
fi

# Install dependencies
echo ""
echo "ğŸ“¦ Installing dependencies..."
npm install

# Create directories
echo ""
echo "ğŸ“ Creating required directories..."
mkdir -p logs workspace backups

# Copy .env.example to .env if it doesn't exist
if [ ! -f .env ]; then
    echo ""
    echo "ğŸ“ Creating .env file..."
    cp .env.example .env
    echo "âœ… .env file created. Please edit it with your configuration."
else
    echo "âœ… .env file already exists"
fi

# Make index.js executable
chmod +x index.js

# Check if Docker is installed (optional)
echo ""
if command -v docker &> /dev/null; then
    echo "âœ… Docker is installed: $(docker --version)"
    echo "   Docker sandboxing is available"
else
    echo "âš ï¸  Docker is not installed"
    echo "   Agents will run in process mode (fork)"
    echo "   To install Docker, run: curl -fsSL https://get.docker.com | sudo sh"
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                   Setup Complete! ğŸ‰                           â•‘"
echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo "â•‘  Next steps:                                                   â•‘"
echo "â•‘  1. Edit .env file:     nano .env                             â•‘"
echo "â•‘  2. Start supervisor:   npm run dev                           â•‘"
echo "â•‘  3. Test API:           curl http://localhost:3001/health     â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘  Documentation:         cat README.md                         â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

